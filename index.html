<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Day Timeline Tracker</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111111" />

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icons/icon-180.png">

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="title">Day Timeline Tracker</div>
      <div class="subtitle">Tap to switch activities • Offline-first</div>
    </div>
    <div class="top-actions">
      <button id="btnEnable" class="btn secondary">Enable Reminders</button>
      <button id="btnInstallHelp" class="btn ghost">Install Help</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="now-row">
        <div class="now-left">
          <div class="label">Currently</div>
          <div id="currentActivity" class="current">—</div>
          <div id="currentSince" class="since">Not tracking</div>
        </div>
        <div class="now-right">
          <button id="btnStop" class="btn danger">Stop</button>
          <button id="btnNote" class="btn">Add Note</button>
        </div>
      </div>

      <div class="grid" id="categoryGrid"></div>

      <div class="settings-row">
        <div class="setting">
          <label>Idle reminder (minutes)</label>
          <select id="idleMinutes">
            <option>15</option>
            <option selected>30</option>
            <option>45</option>
            <option>60</option>
          </select>
        </div>
        <div class="setting">
          <label>Wind-up time</label>
          <input id="windupTime" type="time" value="21:45" />
        </div>
        <div class="setting">
          <label>Reminders</label>
          <label class="switch">
            <input id="remindersEnabled" type="checkbox" checked>
            <span class="slider"></span>
          </label>
        </div>
        <div class="setting status">
          <div class="label">Notification status</div>
          <div id="notifStatus" class="small">Not requested</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="timeline">Timeline</button>
        <button class="tab" data-tab="reminders">Reminders</button>
        <button class="tab" data-tab="stats">Stats</button>
        <button class="tab" data-tab="settings">Settings</button>
      </div>

      <div id="tab-timeline" class="tabpane show">
        <div class="pane-actions">
          <button id="btnWindupNow" class="btn secondary">Wind-up Now</button>
          <button id="btnExport" class="btn ghost">Export JSON</button>
          <button id="btnClearToday" class="btn ghost danger-outline">Clear Today</button>
        </div>
        <div id="timelineList" class="list"></div>
      </div>

      <div id="tab-reminders" class="tabpane">
        <div class="help">
          <h3>Add reminders for any category</h3>
          <ul>
            <li><b>Today (repeating):</b> repeats every X minutes for the rest of today.</li>
            <li><b>Specific date:</b> one-time reminder on that date.</li>
            <li><b>Monthly:</b> repeats every month on the selected day.</li>
          </ul>
        </div>

        <div class="card">
          <div class="rem-form">
            <label class="label">Category</label>
            <select id="remCategory" class="input"></select>

            <label class="label">Reminder</label>
            <input id="remTitle" class="input" placeholder="e.g., Homework, submit report, buy groceries" />

            <label class="label">Type</label>
            <select id="remType" class="input">
              <option value="today" selected>Today (repeating)</option>
              <option value="date">Specific date</option>
              <option value="monthly">Monthly</option>
            </select>

            <div id="remDateRow">
              <label class="label">Date</label>
              <input id="remDate" type="date" class="input" />
            </div>

            <label class="label">Time</label>
            <input id="remTime" type="time" class="input" value="18:30" />

            <div id="remRepeatRow">
              <label class="label">Repeat every (minutes)</label>
              <select id="remRepeat" class="input">
                <option value="30">30</option>
                <option value="60" selected>60</option>
                <option value="90">90</option>
                <option value="120">120</option>
              </select>
            </div>

            <button id="btnAddReminder" class="btn secondary">Add Reminder</button>
          </div>
        </div>

        <div class="row-between">
          <div class="small muted">Your reminders are saved on this device.</div>
          <select id="remFilterCat" class="input" style="max-width:220px"></select>
        </div>

        <div id="reminderList" class="rem-list"></div>
      </div>

      <div id="tab-stats" class="tabpane">
        <div class="stats" id="statsBox"></div>
      </div>

      <div id="tab-settings" class="tabpane">
        <div class="help">
          <h3>Using this on iPhone like an app</h3>
          <ol>
            <li>Open this site in <b>Safari</b>.</li>
            <li>Tap <b>Share</b> → <b>Add to Home Screen</b>.</li>
            <li>Open it from the new icon.</li>
            <li>Tap <b>Enable Reminders</b> and allow notifications.</li>
          </ol>
          <p class="small muted">
            Notifications are most reliable when the app is installed and notifications are allowed.
          </p>
        </div>

        <div class="help">
          <h3>Reminder behavior (important)</h3>
          <ul>
            <li><b>Idle reminder:</b> reminds you if you haven’t switched activities for the chosen minutes.</li>
            <li><b>Wind-up:</b> reminds you at your chosen time to review/edit your day.</li>
            <li><b>Custom reminders:</b> fire while the app is running; installed PWA is most reliable.</li>
            <li><b>Offline:</b> all data is stored locally on your phone (IndexedDB). No account needed.</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <dialog id="noteDialog" class="dialog">
    <form method="dialog" class="dialog-body">
      <h3>Add a note</h3>
      <p class="small muted">This note will attach to the currently running activity (or the latest one).</p>
      <textarea id="noteText" rows="4" placeholder="Type your note..."></textarea>
      <div class="dialog-actions">
        <button class="btn ghost" value="cancel">Cancel</button>
        <button id="btnSaveNote" class="btn" value="default">Save</button>
      </div>
    </form>
  </dialog>

  <dialog id="editDialog" class="dialog">
    <form method="dialog" class="dialog-body">
      <h3>Edit block</h3>
      <div class="form-grid">
        <label>Category
          <select id="editCategory"></select>
        </label>
        <label>Start
          <input id="editStart" type="datetime-local" />
        </label>
        <label>End
          <input id="editEnd" type="datetime-local" />
        </label>
        <label>Note
          <input id="editNote" type="text" placeholder="optional" />
        </label>
      </div>
      <div class="dialog-actions">
        <button class="btn ghost danger-outline" id="btnDeleteBlock" value="default">Delete</button>
        <span class="spacer"></span>
        <button class="btn ghost" value="cancel">Cancel</button>
        <button id="btnSaveEdit" class="btn" value="default">Save</button>
      </div>
      <input type="hidden" id="editId" />
    </form>
  </dialog>

  <script src="dexie.min.js" defer></script>
  <script src="app.js" defer></script>
</body>
</html>
